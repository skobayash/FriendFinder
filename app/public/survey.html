<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
    <title>Survey</title>
    
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="./css/style.css">
</head>
<body>

<div class="container">
    <br>
    <br>
    <h4>About You</h3>
    <hr>
    <div class="form-group"> <!-- NAME -->
        <label for="name">Name</label>
        <input type="text" class="form-control" id="name-input" aria-describedby="emailHelp">
    </div>
    <div class="form-group"> <!-- PHOTO-->
        <label for="photo">Link to Photo</label>
        <input type="text" class="form-control" id="photo-input" aria-describedby="emailHelp" placeholder="https://i.imgur.com/l6oUhdH.jpg">
    </div>

    <h4>Questions</h4>
    <h6>On a scale of 1 (strongly disagree) to 5 (strongly agree), rate how accurate the following statements are.</h6>
    <hr>
    <div class="form-group"> <!-- Q1 -->
        <label for="exampleFormControlSelect1">I have great hygeine.</label>
        <select class="form-control" id="q1input">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
        </select>
    </div>
    <div class="form-group"> <!-- Q2 -->
        <label for="exampleFormControlSelect1">I am a creature of habit.</label>
        <select class="form-control" id="q2input">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
        </select>
    </div>
    <div class="form-group"> <!-- Q3 -->
        <label for="exampleFormControlSelect1">I am a dog person.</label>
        <select class="form-control" id="q3input">
          <option>1</option>
          <option>2</option>
          <option>3</option>
          <option>4</option>
          <option>5</option>
        </select>
    </div>
    <div class="form-group"> <!-- Q4 -->
        <label for="survey">I am a cat person.</label>
        <select class="form-control" id="q4input">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
        </select>
    </div>
    <div class="form-group"> <!-- Q5 -->
        <label for="survey">I dislike being the center of attention.</label>
        <select class="form-control" id="q5input">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
        </select>
    </div>
    <div class="form-group"> <!-- Q6 -->
        <label for="survey">My bedroom tends to be messy.</label>
        <select class="form-control" id="q6input">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
        </select>
    </div>
    <div class="form-group"> <!-- Q7 -->
        <label for="survey">I'm a home-body.</label>
        <select class="form-control" id="q7input">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
        </select>
    </div>
    <div class="form-group"> <!-- Q8 -->
        <label for="survey">I am overwhelmed easily.</label>
        <select class="form-control" id="q8input">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
        </select>
    </div>
    <div class="form-group"> <!-- Q9 -->
        <label for="survey">I like staying out late on weekend nights.</label>
        <select class="form-control" id="q9input">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
        </select>
    </div>
    <div class="form-group"> <!-- Q10 -->
        <label for="survey">I try to spend as much time outside as possible.</label>
        <select class="form-control" id="q10input">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
        </select>
    </div>

    <!-- Submit Button -->
    <input class="btn btn-primary submit" type="submit" value="Submit" data-toggle="modal" data-target="#modalCenter">


</div>

  
  <!-- Modal -->
  <div class="modal fade" id="modalCenter" tabindex="-1" role="dialog" aria-labelledby="modalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="best-match">Best Match:  <span id="modal-name">name</span></h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <span id="modal-photo">...</span>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>



<script type="text/javascript">

// On SUBMIT
$(".submit").on("click", function(){

    // New user info taken from form input and put into object
    var newUser = {
        name: $('#name-input').val().trim(),
        photo: $('#photo-input').val().trim(),
        scores: [
            $('#q1input').val().trim(),
            $('#q2input').val().trim(),
            $('#q3input').val().trim(),
            $('#q4input').val().trim(),
            $('#q5input').val().trim(),
            $('#q6input').val().trim(),
            $('#q7input').val().trim(),
            $('#q8input').val().trim(),
            $('#q9input').val().trim(),
            $('#q10input').val().trim()
        ]
    }

    // Grab window location origin for posting route
    var currentURL = window.location.origin;

    // Post new user object to friends.js data
    $.post(currentURL + "/api/friends", newUser, function(data){
            console.log("Information submitted succesfully.")
    });


    // Get all data from friends.js
    $.get(currentURL + "/api/friends", function(data, status){

       var bestMatch = null;    // Holds index of best match
       var bestMatchName;       // Holds name of best match
       var bestMatchPhoto;      // Holds photo of best match

       var difArray = []; // Array for holding difference between new user & data scores

        // Iterates through each user in user array
        for (var i = 0; i < data.length-1; i++) {

            var sumDifference = 0;  // Holds total difference between scores of new user & other user
    
            // Loops through each score in score array
            for (var j = 0; j < data[0].scores.length; j++) {   
               
                var newScore = parseFloat(newUser.scores[j]);   // New user score
                var userScore = parseFloat(data[i].scores[j]);  // Other use score
                var difference = Math.abs(newScore - userScore)
             
                sumDifference += difference;    // Adding difference in scores to total difference variable
                
                // If iterates all the way through the scores, push final sumdifference into array
                if (j === data[0].scores.length-1) {   
                    difArray.push(sumDifference);       
                    console.log(sumDifference);
                }
            }

            // If comparing new user to final other user in array (where, at this point, last user in array is the new user)
            if (i === data.length - 2) {  

                var temp = 50;  // variable starts at highest possible difference in input answers
                var bestMatch;  

                // Iterates through each sumDifference scores in difference-array & sets modal input to best match
                for (var k = 0; k < difArray.length; k++) {
                    var newVal = parseFloat(difArray[k])
                    if (newVal < temp) {
                        temp = newVal;
                        bestMatch = k

                        $('#modal-name').text(data[k].name)
                        $('#modal-photo').html("<img src=\'" + data[k].photo + "\' alt='image'>")
                    }
                }
            }
        }
    });
});






</script>



</body>
</html>